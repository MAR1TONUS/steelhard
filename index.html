<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>ЧЁРНАЯ СТРЕЛА</title>

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  @font-face{
    font-family: "Bebas Neue Pro";
    src: url("fonts/BebasNeuePro-Regular.woff2") format("woff2"),
         url("fonts/BebasNeuePro-Regular.woff") format("woff");
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }
  @font-face{
    font-family: "Bebas Neue Pro";
    src: url("fonts/BebasNeuePro-Bold.woff2") format("woff2"),
         url("fonts/BebasNeuePro-Bold.woff") format("woff");
    font-weight: 700;
    font-style: normal;
    font-display: swap;
  }

  :root{
    --page-bg: #000;
    --content-max-w: 430px;
    --side-pad: 12px;

    --title-block-w: 100%;
    --title-top: 79px;
    --title-bottom: 100px;
    --title-size: 100px;
    --title-weight: 400;
    --title-color: #fff;
    --title-letter-spacing: .5px;
    --title-line-height: 0.86;

    --divider-width: 100%;
    --divider-thickness: 2px;
    --divider-color: #282828;
    --divider-top: 12px;
    --divider-bottom: 12px;

    --t-title-size: 13px;
    --t-title-weight: 700;
    --t-title-color: #DBDADA;

    --t-chapter-size: 12px;
    --t-chapter-weight: 650;
    --t-chapter-color: #828282;

    --t-time-size: 12px;
    --t-time-weight: 700;
    --t-time-color: #616161;

    --track-title-maxw: 295px;
    --track-text-offset: 5px;

    --aff-width: 345px;
    --aff-bg: rgba(43,43,43,.75);
    --aff-radius: 7px;
    --aff-border: 1px solid rgba(83, 83, 83, 0.2);
    --aff-text-size: 13px;
    --aff-text-weight: 750;
    --aff-text-color: #939393;
    --aff-pad-v: 14px;
    --aff-pad-h: 14px;
    --aff-blur: 4px;

    --player-bg: #000;
    --light-color: rgba(255,255,255,.55);
    --light-blur: 34px;
    --light-size: 64vw;

    --time-top-margin: 10px;
    --time-font-weight: 800;
    --time-font-size: 14px;
    --time-color: #e7e7e7;

    --btn-size: 56px;
  }

  html,body{height:100%;}
  body{
    margin:0; background:var(--page-bg); color:#fff;
    font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    overflow-x:hidden;
  }

  #stars-canvas{ position:fixed; inset:0; z-index:0; display:block; }

  .page{ position:relative; z-index:1; min-height:100dvh; display:flex; }
  .content{
    width:100%; max-width:var(--content-max-w);
    margin:0 auto; padding:0 var(--side-pad) 72px;
    box-sizing:border-box;
  }

  .title-wrap{ width:var(--title-block-w); margin:var(--title-top) auto var(--title-bottom); text-align:center; }
  .title{
    margin:0;
    font-family:"Bebas Neue Pro","Bebas Neue",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    font-size:var(--title-size);
    font-weight:var(--title-weight);
    letter-spacing:var(--title-letter-spacing);
    line-height:var(--title-line-height);
    color:var(--title-color);
    text-transform:uppercase;
  }

  .tracks{ width:100%; }
  .divider{ width:var(--divider-width); height:var(--divider-thickness); background:var(--divider-color); margin:var(--divider-top) auto var(--divider-bottom); }
  .track{ position:relative; display:flex; align-items:center; justify-content:space-between; gap:12px; }
  .track-left{ min-width:0; padding-left:var(--track-text-offset); }
  .track-title{ max-width:var(--track-title-maxw); font-size:var(--t-title-size); font-weight:var(--t-title-weight); color:var(--t-title-color); line-height:1.25; }
  .track-chapter{ margin-top:2px; font-size:var(--t-chapter-size); font-weight:var(--t-chapter-weight); color:var(--t-chapter-color); }
  .track-time{ margin-left:auto; flex:0 0 auto; font-size:var(--t-time-size); font-weight:var(--t-time-weight); color:var(--t-time-color); }

  .aff-card{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:var(--aff-width); padding:var(--aff-pad-v) var(--aff-pad-h); background:var(--aff-bg); border:var(--aff-border); border-radius:var(--aff-radius); text-align:center; display:flex; align-items:center; justify-content:center; pointer-events:none; z-index:2; backdrop-filter:blur(var(--aff-blur)); }
  .aff-text{ font-size:var(--aff-text-size); font-weight:var(--aff-text-weight); color:var(--aff-text-color); line-height:1.2; opacity:0; transition: opacity .6s ease; }
  .aff-text.show{ opacity:1; }

  .player{ width:100%; max-width:var(--content-max-w); margin:36px auto 80px; padding:0 var(--side-pad); box-sizing:border-box; background:var(--player-bg); display:none; }
  :target.player{ display:block; }

  .player .header{ position:relative; width:100%; }
  .player .light{ position:absolute; left:50%; top:0; width:var(--light-size); height:var(--light-size); transform:translate(-50%,-42%); border-radius:50%; background:radial-gradient(circle, var(--light-color) 0%, rgba(0,0,0,0) 60%); filter:blur(var(--light-blur)); pointer-events:none; z-index:0; }
  .player .svg-player{ position:relative; z-index:1; width:100%; }

  .player h2{ margin:16px 0 4px; font-weight:900; font-size:18px; line-height:1.2; }
  .player .chapter{ margin:0 0 10px; font-weight:800; font-size:14px; opacity:.95; }

  .progress{ width:100%; height:6px; background:#262626; border-radius:999px; position:relative; overflow:hidden; }
  .progress__bar{ position:absolute; left:0; top:0; bottom:0; width:0%; background:#f2f2f2; border-radius:999px; }
  .time{ margin-top:var(--time-top-margin); display:flex; justify-content:space-between; font: var(--time-font-weight) var(--time-font-size)/1.1 system-ui; color:var(--time-color); }

  .controls{ margin-top:14px; display:flex; justify-content:space-between; gap:10px; }
  .btn{ display:grid; place-items:center; width:var(--btn-size); height:var(--btn-size); background:transparent; border:0; padding:0; }
  .btn svg{ width:100%; height:100%; display:block; }
</style>
</head>
<body>

<canvas id="stars-canvas" aria-hidden="true"></canvas>

<main class="page">
  <section class="content">
    <div class="title-wrap">
      <h1 class="title">ЧЁРНАЯ СТРЕЛА</h1>
    </div>

    <div class="tracks" id="tracks">
      <article class="track">
        <div class="track-left">
          <div class="track-title" data-title>Джон мщу-за-всех</div>
          <div class="track-chapter">Пролог</div>
        </div>
        <time class="track-time">12:34</time>
      </article>

      <div class="divider"></div>

      <article class="track">
        <div class="track-left">
          <div class="track-title" data-title>Джон мщу-за-всех</div>
          <div class="track-chapter">Пролог</div>
        </div>
        <time class="track-time">12:34</time>

        <div class="aff-card" role="status" aria-live="polite">
          <div class="aff-text" id="affText">Я люблю тебя &lt;З</div>
        </div>
      </article>

      <div class="divider"></div>
    </div>

    <section id="player" class="player">
      <div class="header">
        <div class="light"></div>
        <object class="svg-player" type="image/svg+xml" data="SVG_player.svg" aria-label="Шапка трека"></object>
      </div>

      <h2 id="plTitle">Часть: Тайны замка Тансгет</h2>
      <p class="chapter" id="plChapter">Глава 2</p>

      <div class="progress" id="progress">
        <div class="progress__bar" id="progressBar"></div>
      </div>
      <div class="time">
        <span id="curTime">00:00</span>
        <span id="durTime">00:00</span>
      </div>

      <div class="controls">
        <button class="btn" id="btnPrev" title="Prev" aria-label="Prev"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M7 12L19 4v16L7 12Z"></path><path d="M5 4v16"></path></svg></button>
        <button class="btn" id="btnRew" title="Rewind -15s" aria-label="Rewind"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M11 12 20 6v12l-9-6Z"></path><path d="M4 12l9-6v12l-9-6Z"></path></svg></button>
        <button class="btn" id="btnPlay" title="Play/Pause" aria-label="Play"><svg id="iconPlay" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M8 5v14l11-7-11-7Z"></path></svg></button>
        <button class="btn" id="btnStop" title="Stop" aria-label="Stop"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="6" y="6" width="12" height="12"></rect></svg></button>
        <button class="btn" id="btnFwd" title="Fast fw +30s" aria-label="Fast fw"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M13 12 4 6v12l9-6Z"></path><path d="M20 12l-9-6v12l9-6Z"></path></svg></button>
        <button class="btn" id="btnNext" title="Next" aria-label="Next"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M17 12 5 20V4l12 8Z"></path><path d="M19 4v16"></path></svg></button>
      </div>

      <audio id="audio" preload="metadata"><source src="" type="audio/mpeg" /></audio>
    </section>
  </section>
</main>

<script>
(() => {
  const phrases = [
    'Я люблю тебя <З',
    'У тебя всё получится!',
    'Ты умничка <З',
    'Я горжусь тобой!',
    'Ты прекрасна',
    'Ты моё солнышко <З'
  ];
  const el = document.getElementById('affText');
  if(!el) return;
  let i = 0;

  const getDur = () => {
    const d = getComputedStyle(el).transitionDuration.split(',')[0].trim();
    if (d.endsWith('ms')) return parseFloat(d) || 600;
    if (d.endsWith('s')) return (parseFloat(d) || 0.6) * 1000;
    return 600;
  };
  const D = getDur();

  function cycle(){
    el.classList.remove('show');
    setTimeout(() => {
      i = (i+1) % phrases.length;
      el.textContent = phrases[i];
      requestAnimationFrame(() => el.classList.add('show'));
    }, D);
  }

  el.textContent = phrases[i];
  requestAnimationFrame(() => el.classList.add('show'));
  setInterval(cycle, 7000);
})();

(() => {
  const getCSS = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  const ruler = document.createElement('span');
  Object.assign(ruler.style,{
    position:'absolute', visibility:'hidden', whiteSpace:'nowrap',
    fontSize: getCSS('--t-title-size'),
    fontWeight: getCSS('--t-title-weight'),
    fontFamily: getComputedStyle(document.body).fontFamily
  });
  document.body.appendChild(ruler);

  document.querySelectorAll('[data-title]').forEach(el=>{
    const maxW = parseFloat(getCSS('--track-title-maxw'));
    const txt = el.textContent.trim().replace(/\s+/g,' ');
    el.setAttribute('title', txt);

    ruler.textContent = txt;
    if (ruler.offsetWidth <= maxW) return;

    const words = txt.split(' ');
    let out = '';
    for(let k=0;k<words.length;k++){
      const next = (out ? out+' ' : '') + words[k];
      ruler.textContent = next + '…';
      if (ruler.offsetWidth <= maxW){ out = next; continue; }

      if (words[k].length >= 7){
        let cut = words[k];
        while (cut.length > 1){
          cut = cut.slice(0,-1);
          const cand = (out ? out+' ' : '') + cut + '…';
          ruler.textContent = cand;
          if (ruler.offsetWidth <= maxW){ out = (out? out+' ' : '') + cut; break; }
        }
      }
      break;
    }
    el.textContent = out + '…';
  });
})();

(() =>{
  const audio = document.getElementById('audio');
  const progress = document.getElementById('progress');
  const bar = document.getElementById('progressBar');
  const cur = document.getElementById('curTime');
  const dur = document.getElementById('durTime');

  const btnPlay = document.getElementById('btnPlay');
  const btnStop = document.getElementById('btnStop');
  const btnPrev = document.getElementById('btnPrev');
  const btnNext = document.getElementById('btnNext');
  const btnRew  = document.getElementById('btnRew');
  const btnFwd  = document.getElementById('btnFwd');

  const fmt = t=>{ if(!isFinite(t)) t=0; const m = Math.floor(t/60), s = Math.floor(t%60); return String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0'); };

  audio.addEventListener('loadedmetadata', ()=> dur.textContent = fmt(audio.duration));
  audio.addEventListener('timeupdate', ()=>{ cur.textContent = fmt(audio.currentTime); bar.style.width = ((audio.currentTime/(audio.duration||1))*100)+'%'; });

  progress.addEventListener('click', e=>{
    const r = progress.getBoundingClientRect();
    audio.currentTime = ((e.clientX - r.left)/r.width) * (audio.duration||0);
  });

  btnPlay.addEventListener('click', ()=> { if(audio.paused) audio.play(); else audio.pause(); });
  btnStop.addEventListener('click', ()=> { audio.pause(); audio.currentTime = 0; });
  btnRew .addEventListener('click', ()=> audio.currentTime = Math.max(0, audio.currentTime - 15));
  btnFwd .addEventListener('click', ()=> audio.currentTime = Math.min(audio.duration||0, audio.currentTime + 30));
  btnPrev.addEventListener('click', ()=> {});
  btnNext.addEventListener('click', ()=> {});
})();
</script>
</body>
</html>
