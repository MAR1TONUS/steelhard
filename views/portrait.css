.overlay{
  position:fixed;
  inset:0;
  display:grid;
  place-items:end center;
  background:transparent;
  pointer-events:none;
  z-index:999999;
}
.overlay.open{ pointer-events:auto; }

.sheet{
  width: 100vw;

  /* стабильный «пол» снизу (safe-area + твой зазор) */
  padding-bottom: calc(
    max(16px, env(safe-area-inset-bottom)) + var(--floor-gap, 24px)
  );

  
  min-height: 100svh;
  height: 100vh;   
  height: 100dvh;

  background: var(--bg, #4F4252);

  /* твоя компоновка */
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}


/* Внутренняя группа, которую можно масштабировать целиком */
.stack{
  position:absolute;
  left:50%; top:50%;
  transform-origin:50% 50%;
  transform: translate(-50%, -50%) scale(var(--fit, 1));
}

/* Все существующие блоки привяжем к .stack вместо .sheet */
.stack > .cover,
.stack > .meta,
.stack > .progress-wrap,
.stack > .controls{
  position:absolute;
  left:50%; top:50%;
  transform-origin:50% 50%;
}

.overlay.open .sheet{ transform:translateY(0%); }

/* =========================
   Переменные (портрет)
   ========================= */
:host{

  --safe-top:    env(safe-area-inset-top, 0px);
  --safe-right:  env(safe-area-inset-right, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left:   env(safe-area-inset-left, 0px);


  --lift: 0px;            
  --lift-max: 90px;       
  --lift-min-gap: 70px;   
  --cover-lift-factor: .25;

  /* фон */
  --bg:#5A231A;

  /* шрифты/база */
  --gap:16px;
  --sheet-open-dur: 420ms;
  --sheet-close-dur: 330ms;
  --sheet-ease: cubic-bezier(.2,.9,.2,1);

  /* ОБЛОЖКА (не зависит от высоты экрана) */
  --cover-size:clamp(282px, 32vw, 325px);
  --cover-radius:clamp(8px, 1.6vw, 11px);
  --cover-shadow-x:0px;
  --cover-shadow-y:0px;
  --cover-shadow-blur:22px;
  --cover-shadow-spread:0px;
  --cover-shadow-color:rgba(0,0,0,.5);
  --cover-x:0px;    /* сдвиг обложки от центра по X */
  --cover-y:-170px;    /* сдвиг обложки от центра по Y */

  /* НАЗВАНИЕ */
  --title-size:clamp(18px, 2.4vw, 28px);
  --title-width: clamp(310px, 70vw, 520px);
  --title-color:#ffffff;    
  --title-weight: 780;
  --title-y:120px;
  --title-x:0px;

  /* ГЛАВА */
  --part-size:clamp(14px, 1.8vw, 18px);
  --part-weight:600;
  --part-color:#C7C1CB;
  --part-x:0px;
  --part-y:290px;

  /* КОНТРОЛЫ (контейнер кнопок) */
  --controls-gap:clamp(30px, 3vw, 48px);
  --controls-x:0px;
  --controls-y:225px;

  /* размеры кнопок */
  --size-prev:25px;
  --size-back15:33px; 
  --size-play:clamp(56px, 7vw, 60px);
  --size-fwd30:33px;
  --size-next:25px;

  /* ПРОГРЕСС */
  --progress-width:clamp(320px, 60vw, 520px);
  --progress-height:5px;
  --progress-knob:12px;
  --progress-track:#ffffff40;
  --progress-fill:#FFFFFF;
  --progress-y:340px;

  /*прокрутка плеера*/
  --marquee-speed: 16;   /* пикселей в секунду */
  --marquee-min: 8s; 
  --marquee-max: 50s;   
}

/* Шрифты как в старой версии */
:host, .sheet, .sheet *{
  font-family:"Montserrat", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  box-sizing:border-box;
  -webkit-user-select:none; user-select:none;
  -webkit-touch-callout:none;
}

/* =========================
   Нулевое положение — центр экрана
   Каждый блок абсолютный, сдвигается от центра по X/Y
   ========================= */

/* 1) Обложка */
.cover{
  transform: translate(-50%, -50%)
             translate(var(--cover-x), calc(var(--cover-y) - var(--lift) * var(--cover-lift-factor)));
  position:absolute; left:50%; top:50%;
  width:var(--cover-size); height:var(--cover-size);
  border-radius:var(--cover-radius);
  overflow:hidden;
  box-shadow:var(--cover-shadow-x) var(--cover-shadow-y) var(--cover-shadow-blur)
             var(--cover-shadow-spread) var(--cover-shadow-color);
  display:grid; place-items:center;
  z-index:10;
}
.cover .img{
  width:100%; height:100%;
  background:#444 center/cover no-repeat; /* картинка прилетает из JS как background-image */
  border-radius:inherit;
}

/* 2) Название */
.title{
  transform: translate(-50%, -50%)
             translate(var(--title-x), calc(var(--title-y) - var(--lift)));
  position:absolute; left:50%; top:50%;

  width: var(--title-width, clamp(280px, 70vw, 520px));

  font-family: "Montserrat", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  font-weight: var(--title-weight, 780);
  font-size: var(--title-size, clamp(18px, 2.4vw, 28px));
  color: var(--title-color, #E6E1EA);

  text-align:center;
  white-space:nowrap;
  overflow:hidden;
  height:1.25em; 
  line-height:1.2;

  margin: 0;
  padding: 0;
  text-align: center;

  -webkit-mask-image: none;
          mask-image: none;

  z-index:20;
}

/* маска только когда реально не влезает — класс ставит JS */
.title.is-clip{
  -webkit-mask-image: linear-gradient(to right, transparent 0%, #000 9%, #000 91%, transparent 100%);
          mask-image: linear-gradient(to right, transparent 0%, #000 9%, #000 91%, transparent 100%);
}

/* лента текста + клон (JS добавляет) */
.title .track{
  display:inline-flex;
  gap:24px;                 /* не меняй, это же значение читает JS */
  will-change: transform;
  font: inherit;
  color: inherit;
}

/* включение прокрутки (JS добавляет класс .marquee) */
.title.marquee .track{
  animation: marquee-loop var(--dur, 14s) linear infinite;
}

/* прокрутка на ширину первой копии + gap */
@keyframes marquee-loop{
  from{ transform: translateX(0); }
  to  { transform: translateX(calc(-1 * var(--dist, 0px))); }
}

/* 3) Контролы */
.controls{
  transform: translate(-50%, -50%)
             translate(var(--controls-x), calc(var(--controls-y) - var(--lift)));
  position:absolute; left:50%; top:50%;
  display:flex; align-items:center; justify-content:center;
  gap:var(--controls-gap);
  z-index:30;
}
.controls button{
  all:unset; display:grid; place-items:center; cursor:pointer; border-radius:999px;
}
#prev  img{ width:var(--size-prev);   height:var(--size-prev); }
#back15 img{ width:var(--size-back15); height:var(--size-back15); }
#pp    img{ width:var(--size-play);   height:var(--size-play); }
#fwd30 img{ width:var(--size-fwd30);  height:var(--size-fwd30); }
#next  img{ width:var(--size-next);   height:var(--size-next); }
.controls img{ display:block; }

/* 4) Глава */
.part{
  transform: translate(-50%, -50%)
             translate(var(--part-x), calc(var(--part-y) - var(--lift)));
  position:absolute; left:50%; top:50%;
  text-align:center;
  color:var(--part-color);
  font-weight:var(--part-weight);
  font-size:var(--part-size);
  line-height:1.2;
  z-index:25;
  white-space: nowrap;
  word-break: keep-all;
}

/* 5) Прогресс */
.progress-wrap{
  transform: translate(-50%, -50%)
             translate(var(--progress-x, 0px), calc(var(--progress-y, 0px) - var(--lift)));
  position:absolute; left:50%; top:50%;
  width:var(--progress-width);
  z-index:35;
}
.bar{
  position:relative;
  height:var(--progress-height);
  background:var(--progress-track);
  border-radius:999px;
  cursor:pointer;
  touch-action:none;
}
.fill{
  height:100%; width:0%;
  background:var(--progress-fill);
  border-radius:inherit;
}
.knob{
  position:absolute; top:50%; left:0%;
  width:var(--progress-knob); height:var(--progress-knob);
  border-radius:50%;
  background:var(--progress-fill);
  transform:translate(-50%, -50%);
  pointer-events:none;
}
.time{
  display:flex; justify-content:space-between;
  color:#9f9f9f;
  font-weight:550; 
  font-size:13px;
  margin-top:6px;
}

.controls img {
  display: block;
  transform-origin: 50% 50%;
}

.controls img.bump {
  animation: pp-bump 140ms ease-out;
}

@keyframes pp-bump {
  0%   { transform: scale(1); }
  50%  { transform: scale(var(--pp-bump-scale, 1.07)); }
  100% { transform: scale(1); }
}

@media (prefers-reduced-motion: reduce) {
  .title.marquee .track { animation: none; }
  .controls img.bump { animation: none; }
}

:host .sheet .progress-wrap{
  width: var(--progress-width) !important;
  min-width: var(--progress-width) !important;
  max-width: var(--progress-width) !important;
}
:host .sheet .progress-wrap .bar{
  width: 100% !important;
}


